(window.webpackJsonp=window.webpackJsonp||[]).push([["npm.web3-core-method"],{7789:function(t,e,r){"use strict";var a=r("17fb"),n=r("c044").errors,o=r("c044").formatters,i=r("5ba3"),s=r("00d7"),c=r("c3e6").subscriptions,u=r("5ac3"),l=function(t){if(!t.call||!t.name)throw new Error('When creating a method you need to provide at least the "name" and "call" property.');this.name=t.name,this.call=t.call,this.params=t.params||0,this.inputFormatter=t.inputFormatter,this.outputFormatter=t.outputFormatter,this.transformPayload=t.transformPayload,this.extraFormatters=t.extraFormatters,this.abiCoder=t.abiCoder,this.requestManager=t.requestManager,this.accounts=t.accounts,this.defaultBlock=t.defaultBlock||"latest",this.defaultAccount=t.defaultAccount||null,this.transactionBlockTimeout=t.transactionBlockTimeout||50,this.transactionConfirmationBlocks=t.transactionConfirmationBlocks||24,this.transactionPollingTimeout=t.transactionPollingTimeout||750,this.defaultCommon=t.defaultCommon,this.defaultChain=t.defaultChain,this.defaultHardfork=t.defaultHardfork,this.handleRevert=t.handleRevert};l.prototype.setRequestManager=function(t,e){this.requestManager=t,e&&(this.accounts=e)},l.prototype.createFunction=function(t,e){var r=this.buildCall();return r.call=this.call,this.setRequestManager(t||this.requestManager,e||this.accounts),r},l.prototype.attachToObject=function(t){var e=this.buildCall();e.call=this.call;var r=this.name.split(".");r.length>1?(t[r[0]]=t[r[0]]||{},t[r[0]][r[1]]=e):t[r[0]]=e},l.prototype.getCall=function(t){return a.isFunction(this.call)?this.call(t):this.call},l.prototype.extractCallback=function(t){if(a.isFunction(t[t.length-1]))return t.pop()},l.prototype.validateArgs=function(t){if(t.length!==this.params)throw n.InvalidNumberOfParams(t.length,this.params,this.name)},l.prototype.formatInput=function(t){var e=this;return this.inputFormatter?this.inputFormatter.map((function(r,a){return r?r.call(e,t[a]):t[a]})):t},l.prototype.formatOutput=function(t){var e=this;return a.isArray(t)?t.map((function(t){return e.outputFormatter&&t?e.outputFormatter(t):t})):this.outputFormatter&&t?this.outputFormatter(t):t},l.prototype.toPayload=function(t){var e=this.getCall(t),r=this.extractCallback(t),a=this.formatInput(t);this.validateArgs(a);var n={method:e,params:a,callback:r};return this.transformPayload&&(n=this.transformPayload(n)),n},l.prototype._confirmTransaction=function(t,e,r){var m=this,h=!1,p=!0,f=0,d=0,v=null,g=null,b=a.isObject(r.params[0])&&r.params[0].gas?r.params[0].gas:null,y=a.isObject(r.params[0])&&r.params[0].data&&r.params[0].from&&!r.params[0].to,E=y&&r.params[0].data.length>2,w=[new l({name:"getBlockByNumber",call:"eth_getBlockByNumber",params:2,inputFormatter:[o.inputBlockNumberFormatter,function(t){return!!t}],outputFormatter:o.outputBlockFormatter}),new l({name:"getTransactionReceipt",call:"eth_getTransactionReceipt",params:1,inputFormatter:[null],outputFormatter:o.outputTransactionReceiptFormatter}),new l({name:"getCode",call:"eth_getCode",params:2,inputFormatter:[o.inputAddressFormatter,o.inputDefaultBlockNumberFormatter]}),new l({name:"getTransactionByHash",call:"eth_getTransactionByHash",params:1,inputFormatter:[null],outputFormatter:o.outputTransactionFormatter}),new c({name:"subscribe",type:"eth",subscriptions:{newBlockHeaders:{subscriptionName:"newHeads",params:0,outputFormatter:o.outputBlockFormatter}}})],k={};a.each(w,(function(t){t.attachToObject(k),t.requestManager=m.requestManager}));var F=function(a,c,l,w,F){if(!l)return F||(F={unsubscribe:function(){clearInterval(v)}}),(a?s.resolve(a):k.getTransactionReceipt(e)).catch((function(e){F.unsubscribe(),h=!0,i._fireError({message:"Failed to check for transaction receipt:",data:e},t.eventEmitter,t.reject)})).then((async function(e){if(!e||!e.blockHash)throw new Error("Receipt missing or blockHash null");if(m.extraFormatters&&m.extraFormatters.receiptFormatter&&(e=m.extraFormatters.receiptFormatter(e)),t.eventEmitter.listeners("confirmation").length>0){var r;if(void 0===a||0!==d){var n=await k.getBlockByNumber("latest"),o=n?n.hash:null;c?g?(r=await k.getBlockByNumber(g.number+1))&&(g=r,t.eventEmitter.emit("confirmation",d,e,o)):(r=await k.getBlockByNumber(e.blockNumber),g=r,t.eventEmitter.emit("confirmation",d,e,o)):t.eventEmitter.emit("confirmation",d,e,o)}(c&&r||!c)&&d++,p=!1,d===m.transactionConfirmationBlocks+1&&(F.unsubscribe(),t.eventEmitter.removeAllListeners())}return e})).then((async function(e){if(y&&!h){if(!e.contractAddress)return p&&(F.unsubscribe(),h=!0),void i._fireError(n.NoContractAddressFoundError(e),t.eventEmitter,t.reject,null,e);var r;try{r=await k.getCode(e.contractAddress)}catch(t){}if(!r)return;!0===e.status&&E||r.length>2?(t.eventEmitter.emit("receipt",e),m.extraFormatters&&m.extraFormatters.contractDeployFormatter?t.resolve(m.extraFormatters.contractDeployFormatter(e)):t.resolve(e),p&&t.eventEmitter.removeAllListeners()):i._fireError(n.ContractCodeNotStoredError(e),t.eventEmitter,t.reject,null,e),p&&F.unsubscribe(),h=!0}return e})).then((async function(e){if(!y&&!h){if(e.outOfGas||b&&b===e.gasUsed||!0!==e.status&&"0x1"!==e.status&&void 0!==e.status)if(JSON.stringify(e,null,2),!1===e.status||"0x0"===e.status)try{var a=null;if(!m.handleRevert||"eth_sendTransaction"!==m.call&&"eth_sendRawTransaction"!==m.call)throw!1;var s=r.params[0];if("eth_sendRawTransaction"===m.call){var c=r.params[0],l=u.parse(c);s=o.inputTransactionFormatter({data:l.data,to:l.to,from:l.from,gas:l.gasLimit.toHexString(),gasPrice:l.gasPrice.toHexString(),value:l.value.toHexString()})}if(!(a=await m.getRevertReason(s,e.blockNumber)))throw!1;i._fireError(n.TransactionRevertInstructionError(a.reason,a.signature,e),t.eventEmitter,t.reject,null,e)}catch(r){i._fireError(n.TransactionRevertedWithoutReasonError(e),t.eventEmitter,t.reject,null,e)}else i._fireError(n.TransactionOutOfGasError(e),t.eventEmitter,t.reject,null,e);else t.eventEmitter.emit("receipt",e),t.resolve(e),p&&t.eventEmitter.removeAllListeners();p&&F.unsubscribe(),h=!0}})).catch((function(){f++,c?f-1>=m.transactionPollingTimeout&&(F.unsubscribe(),h=!0,i._fireError(n.TransactionError("Transaction was not mined within "+m.transactionPollingTimeout+" seconds, please make sure your transaction was properly sent. Be aware that it might still be mined!"),t.eventEmitter,t.reject)):f-1>=m.transactionBlockTimeout&&(F.unsubscribe(),h=!0,i._fireError(n.TransactionError("Transaction was not mined within "+m.transactionBlockTimeout+" blocks, please make sure your transaction was properly sent. Be aware that it might still be mined!"),t.eventEmitter,t.reject))}));F.unsubscribe(),h=!0,i._fireError({message:"Failed to subscribe to new newBlockHeaders to confirm the transaction receipts.",data:l},t.eventEmitter,t.reject)},T=function(t){const e=()=>{v=setInterval(F.bind(null,t,!0),1e3)};this.requestManager.provider.on?k.subscribe("newBlockHeaders",(function(r,a,n){r||!a?e():F(t,!1,r,0,n)})):e()}.bind(this);k.getTransactionReceipt(e).then((function(e){e&&e.blockHash?(t.eventEmitter.listeners("confirmation").length>0&&T(e),F(e,!1)):h||T()})).catch((function(){h||T()}))};var m=function(t,e){return a.isNumber(t)?e.wallet[t]:a.isObject(t)&&t.address&&t.privateKey?t:e.wallet[t.toLowerCase()]};l.prototype.buildCall=function(){var t=this,e="eth_sendTransaction"===t.call||"eth_sendRawTransaction"===t.call,r="eth_call"===t.call,o=function(){var o=s(!e),c=t.toPayload(Array.prototype.slice.call(arguments)),u=function(a,s){var u;if(t.handleRevert&&r&&t.abiCoder&&(!a&&t.isRevertReasonString(s)?u=s.substring(10):a&&a.data&&(u=a.data.substring(10)),u)){var l=t.abiCoder.decodeParameter("string","0x"+u);return void i._fireError(n.RevertInstructionError(l,"Error(String)"),o.eventEmitter,o.reject,c.callback,{reason:l,signature:"Error(String)"})}try{s=t.formatOutput(s)}catch(t){a=t}if(s instanceof Error&&(a=s),a)return a.error&&(a=a.error),i._fireError(a,o.eventEmitter,o.reject,c.callback);c.callback&&c.callback(null,s),e?(o.eventEmitter.emit("transactionHash",s),t._confirmTransaction(o,s,c)):a||o.resolve(s)},h=function(e){var r=a.extend({},c,{method:"eth_sendRawTransaction",params:[e.rawTransaction]});t.requestManager.send(r,u)},p=function(t,e){var r;if(e&&e.accounts&&e.accounts.wallet&&e.accounts.wallet.length)if("eth_sendTransaction"===t.method){var n=t.params[0];if((r=m(a.isObject(n)?n.from:null,e.accounts))&&r.privateKey){var i=a.omit(n,"from");return e.defaultChain&&!i.chain&&(i.chain=e.defaultChain),e.defaultHardfork&&!i.hardfork&&(i.hardfork=e.defaultHardfork),e.defaultCommon&&!i.common&&(i.common=e.defaultCommon),void e.accounts.signTransaction(i,r.privateKey).then(h).catch((function(t){if(a.isFunction(o.eventEmitter.listeners)&&o.eventEmitter.listeners("error").length){try{o.eventEmitter.emit("error",t)}catch(t){}o.eventEmitter.removeAllListeners(),o.eventEmitter.catch((function(){}))}o.reject(t)}))}}else if("eth_sign"===t.method){var s=t.params[1];if((r=m(t.params[0],e.accounts))&&r.privateKey){var c=e.accounts.sign(s,r.privateKey);return t.callback&&t.callback(null,c.signature),void o.resolve(c.signature)}}return e.requestManager.send(t,u)};if(e&&a.isObject(c.params[0])&&void 0===c.params[0].gasPrice){var f=new l({name:"getGasPrice",call:"eth_gasPrice",params:0}).createFunction(t.requestManager);f((function(r,a){a&&(c.params[0].gasPrice=a),e&&setTimeout(()=>{o.eventEmitter.emit("sending",c)},0),p(c,t)}))}else e&&setTimeout(()=>{o.eventEmitter.emit("sending",c)},0),p(c,t);return e&&setTimeout(()=>{o.eventEmitter.emit("sent",c)},0),o.eventEmitter};return o.method=t,o.request=this.request.bind(this),o},l.prototype.getRevertReason=function(t,e){var r=this;return new Promise((function(a,n){new l({name:"call",call:"eth_call",params:2,abiCoder:r.abiCoder,handleRevert:!0}).createFunction(r.requestManager)(t,i.numberToHex(e)).then((function(){a(!1)})).catch((function(t){t.reason?a({reason:t.reason,signature:t.signature}):n(t)}))}))},l.prototype.isRevertReasonString=function(t){return a.isString(t)&&(t.length-2)/2%32==4&&"0x08c379a0"===t.substring(0,10)},l.prototype.request=function(){var t=this.toPayload(Array.prototype.slice.call(arguments));return t.format=this.formatOutput.bind(this),t},t.exports=l}}]);